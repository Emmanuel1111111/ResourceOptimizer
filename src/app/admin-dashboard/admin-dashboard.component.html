<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <title>Admin Dashboard - ResourceOptimizer</title>
</head>
<body>
<div class="ultra-modern-dashboard" [class.sidebar-open]="sidebarOpen">
  
  <!-- Ultra-Modern Sidebar -->
  <nav class="ultra-sidebar" [class.open]="sidebarOpen" #sidebar style="min-height: 100vh;">
    <div class="sidebar-header">
      <div class="logo-container">
        <div class="logo-icon">
          <i class="fas fa-graduation-cap"></i>
        </div>
        <span class="logo-text">Resource</span>
      </div>
      <button class="sidebar-toggle" (click)="toggleSidebar()">
    <i class="fas" [class.fa-bars]="!sidebarOpen" [class.fa-times]="sidebarOpen"></i>
  </button>
    </div>

    <!-- Enhanced User Profile Section -->
    <div class="user-profile" *ngIf="userId">
      <div class="user-avatar" (click)="triggerAvatarUpload()">
        <img *ngIf="userProfile.avatar" [src]="userProfile.avatar" alt="User Avatar" class="avatar-img">
        <i *ngIf="!userProfile.avatar" class="fas fa-user-circle default-avatar"></i>
        <div class="avatar-overlay">
          <i class="fas fa-camera"></i>
        </div>
      </div>
      <div class="user-info">
        <h4 class="user-name">{{userProfile.firstName}} {{userProfile.lastName}}</h4>
        <p class="user-role">{{userProfile.role}}</p>
        <p class="user-department">{{userProfile.department}}</p>
        <div class="status-indicator online"></div>
      </div>
    </div>

    <!-- Navigation Menu -->
    <div class="nav-menu" >
      <div class="nav-section">
        <p class="nav-section-title">Main</p>
        <a class="nav-item active" routerLink="/admin-dashboard" routerLinkActive="active">
          <div class="nav-icon">
            <i class="fas fa-home"></i>
          </div>
          <span class="nav-text">Dashboard</span>
          <div class="nav-indicator"></div>
        </a>
        
        <a class="nav-item" (click)="navigateToSchedules()" [class.active]="currentRoute === 'schedules'">
          <div class="nav-icon">
            <i class="fas fa-calendar-alt"></i>
          </div>
          <span class="nav-text">All Schedules</span>
        </a>
        
        <a class="nav-item" (click)="navigateToRooms()" [class.active]="currentRoute === 'rooms'">
          <div class="nav-icon">
        <i class="fas fa-door-open"></i>
          </div>
          <span class="nav-text">Rooms</span>
        </a>
        
        <a class="nav-item" (click)="navigateToAnalytics()" [class.active]="currentRoute === 'analytics'">
          <div class="nav-icon">
            <i class="fas fa-chart-line"></i>
          </div>
          <span class="nav-text">Analytics</span>
        </a>
      </div>

      <div class="nav-section">
        <p class="nav-section-title">Management</p>
        <a class="nav-item" (click)="navigateToCourses()" [class.active]="currentRoute === 'courses'">
          <div class="nav-icon">
        <i class="fas fa-book"></i>
          </div>
          <span class="nav-text">Courses</span>
      </a>
        
        <a class="nav-item" (click)="navigateToDepartments()" [class.active]="currentRoute === 'departments'">
          <div class="nav-icon">
        <i class="fas fa-building"></i>
          </div>
          <span class="nav-text">Departments</span>
        </a>
        
        <a class="nav-item" (click)="navigateToReports()" [class.active]="currentRoute === 'reports'">
          <div class="nav-icon">
            <i class="fas fa-file-alt"></i>
          </div>
          <span class="nav-text">Reports</span>
        </a>
      </div>
      
      <div class="nav-section">
        <p class="nav-section-title">System</p>
        <a class="nav-item" (click)="navigateToSettings()" [class.active]="currentRoute === 'settings'">
          <div class="nav-icon">
        <i class="fas fa-cog"></i>
          </div>
          <span class="nav-text">Settings</span>
        </a>
        
        <a class="nav-item" (click)="navigateToHelp()" [class.active]="currentRoute === 'help'">
          <div class="nav-icon">
            <i class="fas fa-question-circle"></i>
          </div>
          <span class="nav-text">Help & Support</span>
        </a>
      </div>
    </div>

    <!-- Sidebar Footer -->
    <div class="sidebar-footer">
      <button class="logout-btn" (click)="logout()">
        <i class="fas fa-sign-out-alt"></i>
        <span>Logout</span>
      </button>
    </div>
  </nav>

  <!-- Main Content Area -->
  <main class="main-content">
    
    <!-- Top Header -->
    <header class="top-header">
      <div class="header-left">
        <button class="mobile-menu-btn" (click)="toggleSidebar()" *ngIf="isMobile">
          <i class="fas fa-bars"></i>
        </button>
        <div class="page-title">
          <h1>Admin Dashboard</h1>
          <p>Manage your university resources efficiently</p>
        </div>
      </div>
      
      <div class="header-right">
        <div class="header-actions">
          <!-- Enhanced Search -->
          <div class="search-container">
            <input type="text" 
                   placeholder="Search rooms, schedules..." 
                   [(ngModel)]="searchQuery"
                   (input)="onSearchInput($event)"
                   class="global-search">
            <i class="fas fa-search"></i>
            <button *ngIf="searchQuery" class="clear-search" (click)="clearSearch()">
              <i class="fas fa-times"></i>
            </button>
            
            <!-- Search Results Dropdown -->
            <div class="search-results" *ngIf="searchResults.length > 0 || isSearching">
              <div class="search-loading" *ngIf="isSearching">
                <div class="loading-spinner"></div>
                <span>Searching...</span>
              </div>
              
              <div class="search-result" 
                   *ngFor="let result of searchResults" 
                   (click)="result.action()">
                <i [class]="result.icon"></i>
                <div class="result-content">
                  <h4>{{result.title}}</h4>
                  <p>{{result.subtitle}}</p>
                </div>
              </div>
              
              <div class="no-results" *ngIf="!isSearching && searchResults.length === 0 && searchQuery">
                <i class="fas fa-search"></i>
                <span>No results found for "{{searchQuery}}"</span>
              </div>
            </div>
          </div>
          
          <!-- Enhanced Notifications -->
          <div class="notification-container">
            <button class="notification-btn" (click)="toggleNotifications()">
              <i class="fas fa-bell"></i>
              <span class="notification-badge" *ngIf="hasUnreadNotifications">
                {{unreadNotificationCount}}
              </span>
            </button>
            
            <!-- Enhanced Notification Dropdown -->
            <div class="notification-dropdown" *ngIf="showNotifications">
              <div class="notification-header">
                <h4>Notifications</h4>
                <button (click)="markAllAsRead()" *ngIf="hasUnreadNotifications">
                  Mark all as read
                </button>
              </div>
              <div class="notification-list">
                <div class="notification-item"
                     *ngFor="let notification of notifications"
                     [class.unread]="!notification.read"
                     [class.conflict-notification]="notification.type === 'schedule_conflict'"
                     (click)="markNotificationAsRead(notification)">
                  <div class="notification-icon" [ngClass]="notification.type">
                    <i class="fas"
                       [class.fa-exclamation-triangle]="notification.type === 'schedule_conflict'"
                       [class.fa-bell]="notification.type !== 'schedule_conflict'"></i>
                  </div>
                  <div class="notification-content">
                    <h5>{{notification.title}}</h5>
                    <p class="notification-message">{{notification.message}}</p>

                    <!-- Enhanced conflict details -->
                    <div class="conflict-details" *ngIf="notification.type === 'schedule_conflict' && notification.data?.conflicts">
                      <div class="conflict-summary">
                        <span class="conflict-badge" [class]="notification.data.severity?.toLowerCase()">
                          {{notification.data.severity}} Priority
                        </span>
                        <span class="conflict-count">{{notification.data.conflict_count}} conflict{{notification.data.conflict_count > 1 ? 's' : ''}}</span>
                      </div>

                      <!-- Quick conflict preview -->
                      <div class="conflict-preview" *ngIf="notification.data.display_data">
                        <div class="preview-item" *ngIf="notification.data.display_data.room_ids?.length > 0">
                          <i class="fas fa-door-open"></i>
                          <span>📍 {{notification.data.display_data.room_ids.slice(0, 3).join(', ')}}{{notification.data.display_data.room_ids.length > 3 ? '...' : ''}}</span>
                        </div>
                        <div class="preview-item" *ngIf="notification.data.display_data.days_of_week?.length > 0">
                          <i class="fas fa-calendar-day"></i>
                          <span>📅 {{notification.data.display_data.days_of_week.slice(0, 3).join(', ')}}{{notification.data.display_data.days_of_week.length > 3 ? '...' : ''}}</span>
                        </div>
                        <div class="preview-item" *ngIf="notification.data.display_data.conflicting_time_slots?.length > 0">
                          <i class="fas fa-clock"></i>
                          <span>⏰ {{notification.data.display_data.conflicting_time_slots[0]}}{{notification.data.display_data.conflicting_time_slots.length > 1 ? ' +' + (notification.data.display_data.conflicting_time_slots.length - 1) + ' more' : ''}}</span>
                        </div>
                      </div>

                      <div class="affected-summary" *ngIf="notification.data.summary">
                        <div class="summary-item">
                          <i class="fas fa-door-open"></i>
                          <span>{{notification.data.summary.rooms_affected?.length || 0}} room{{(notification.data.summary.rooms_affected?.length || 0) !== 1 ? 's' : ''}}</span>
                        </div>
                        <div class="summary-item">
                          <i class="fas fa-calendar-day"></i>
                          <span>{{notification.data.summary.days_affected?.length || 0}} day{{(notification.data.summary.days_affected?.length || 0) !== 1 ? 's' : ''}}</span>
                        </div>
                        <div class="summary-item">
                          <i class="fas fa-building"></i>
                          <span>{{notification.data.summary.departments_affected?.length || 0}} dept{{(notification.data.summary.departments_affected?.length || 0) !== 1 ? 's' : ''}}</span>
                        </div>
                      </div>

                      <button class="view-details-btn"
                              (click)="$event.stopPropagation(); viewConflictDetails(notification)"
                              *ngIf="notification.data.conflicts?.length > 0">
                        <i class="fas fa-eye"></i>
                        View Full Details
                      </button>
                    </div>

                    <small>{{notification.time_ago}}</small>
                  </div>
                  <div class="notification-status" *ngIf="!notification.read">
                    <div class="unread-dot"></div>
                  </div>
                </div>
                
                <div class="empty-notifications" *ngIf="notifications.length === 0">
                  <i class="fas fa-bell-slash"></i>
                  <p>No notifications</p>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Enhanced User Menu -->
          <div class="user-menu">
            <button class="user-menu-btn" (click)="toggleUserMenu()">
              <img *ngIf="userProfile.avatar" [src]="userProfile.avatar" alt="User" class="user-menu-avatar">
              <i *ngIf="!userProfile.avatar" class="fas fa-user-circle user-menu-icon"></i>
              <span class="user-menu-text">{{userProfile.firstName}}</span>
              <i class="fas fa-chevron-down"></i>
            </button>
            
            <!-- User Menu Dropdown -->
            <div class="user-menu-dropdown" *ngIf="showUserMenu">
              <div class="user-menu-header">
                <div class="user-menu-avatar-large">
                  <img *ngIf="userProfile.avatar" [src]="userProfile.avatar" alt="User">
                  <i *ngIf="!userProfile.avatar" class="fas fa-user-circle"></i>
                </div>
                <div class="user-menu-info">
                  <h4>{{userProfile.firstName}} {{userProfile.lastName}}</h4>
                  <p>{{userProfile.email}}</p>
                  <span class="role-badge">{{userProfile.role}}</span>
                </div>
              </div>
              
              <div class="user-menu-actions">
                <button class="menu-action" (click)="triggerAvatarUpload()">
                  <i class="fas fa-camera"></i>
                  <span>Change Photo</span>
                </button>
                <button class="menu-action">
                  <i class="fas fa-user-edit"></i>
                  <span>Edit Profile</span>
                </button>
                <button class="menu-action">
                  <i class="fas fa-cog"></i>
                  <span>Settings</span>
                </button>
                <hr>
                <button class="menu-action logout" (click)="logout()">
                  <i class="fas fa-sign-out-alt"></i>
                  <span>Logout</span>
          </button>
              </div>
            </div>
          </div>
        </div>
        </div>
      </header>

    <!-- Dashboard Content -->
    <div class="dashboard-content">
        
      <!-- Quick Stats Grid -->
      <section class="stats-section">
        <div class="stats-grid">
          <div class="stat-card rooms" (click)="navigateToRooms()"
               matTooltip="Click to view all rooms. Trend shows room utilization percentage.">
            <div class="stat-icon">
              <i class="fas fa-door-open"></i>
            </div>
            <div class="stat-content">
              <h3 class="stat-number" [@countUp]="userStats.totalRooms">{{ userStats.totalRooms }}</h3>
              <p class="stat-label">Total Rooms</p>
              <div class="stat-trend positive" *ngIf="roomsTrend > 0"
                   matTooltip="{{roomsTrend}}% of rooms have active schedules">
                <i class="fas fa-arrow-up"></i>
                <span>{{roomsTrend}}%</span>
              </div>
              <div class="stat-trend neutral" *ngIf="roomsTrend === 0"
                   matTooltip="No rooms have schedules or data unavailable">
                <i class="fas fa-minus"></i>
                <span>0%</span>
              </div>
            </div>
            <div class="stat-actions">
              <button class="quick-action-btn" matTooltip="View All Rooms" (click)="$event.stopPropagation(); navigateToRooms()">
                <i class="fas fa-eye"></i>
              </button>
              <button class="quick-action-btn" matTooltip="Refresh Room Count" (click)="$event.stopPropagation(); loadRoomStats()">
                <i class="fas fa-sync-alt"></i>
              </button>
            </div>
          </div>
          
          <div class="stat-card bookings" (click)="navigateToBookings()">
            <div class="stat-icon">
              <i class="fas fa-calendar-check"></i>
            </div>
            <div class="stat-content">
              <h3 class="stat-number" [@countUp]="userStats.activeBookings">{{ userStats.activeBookings }}</h3>
              <p class="stat-label">Active Bookings</p>
              <div class="stat-trend positive" *ngIf="bookingsTrend > 0">
                <i class="fas fa-arrow-up"></i>
                <span>+{{bookingsTrend}}%</span>
              </div>
            </div>
            <div class="stat-actions">
              <button class="quick-action-btn" matTooltip="Manage Bookings">
                <i class="fas fa-edit"></i>
              </button>
            </div>
          </div>
          
          <div class="stat-card requests" (click)="navigateToRequests()">
            <div class="stat-icon">
              <i class="fas fa-clock"></i>
            </div>
            <div class="stat-content">
              <h3 class="stat-number" [@countUp]="userStats.pendingRequests">{{ userStats.pendingRequests }}</h3>
              <p class="stat-label">Pending Requests</p>
              <div class="stat-trend" [class.positive]="requestsTrend > 0" [class.negative]="requestsTrend < 0">
                <i class="fas" [class.fa-arrow-up]="requestsTrend > 0" [class.fa-arrow-down]="requestsTrend < 0"></i>
                <span>{{requestsTrend > 0 ? '+' : ''}}{{requestsTrend}}%</span>
              </div>
            </div>
            <div class="stat-actions">
              <button class="quick-action-btn" matTooltip="Review Requests">
                <i class="fas fa-list"></i>
              </button>
            </div>
          </div>
          
          <div class="stat-card utilization" (click)="navigateToAnalytics()">
            <div class="stat-icon">
              <i class="fas fa-chart-pie"></i>
            </div>
            <div class="stat-content">
              <h3 class="stat-number" [@countUp]="userStats.utilizationRate">{{ userStats.utilizationRate }}%</h3>
              <p class="stat-label">Utilization Rate</p>
              <div class="utilization-progress">
                <div class="progress-bar" [style.width.%]="userStats.utilizationRate"></div>
              </div>
            </div>
            <div class="stat-actions">
              <button class="quick-action-btn" matTooltip="View Analytics">
                <i class="fas fa-chart-line"></i>
              </button>
            </div>
          </div>
        </div>
      </section>

      <!-- Conflict Monitoring Section -->
      <section class="conflict-monitoring-section">
        <div class="section-header">
          <h2>🔍 Automated Conflict Detection</h2>
          <p>Monitor and detect schedule conflicts automatically</p>
        </div>

        <div class="monitoring-controls">
          <div class="monitoring-status">
            <div class="status-indicator" [class.active]="conflictMonitoringActive" [class.inactive]="!conflictMonitoringActive">
              <i class="fas" [class.fa-play-circle]="!conflictMonitoringActive" [class.fa-pause-circle]="conflictMonitoringActive"></i>
              <span>{{ conflictMonitoringActive ? 'Active' : 'Inactive' }}</span>
            </div>

            <div class="monitoring-info">
              <div class="info-item">
                <label>Scan Interval:</label>
                <span>{{ Math.round(conflictScanInterval / 60) }} minutes</span>
              </div>
              <div class="info-item">
                <label>Last Scan:</label>
                <span>{{ lastConflictScan }}</span>
              </div>
              <div class="info-item" *ngIf="conflictsDetected > 0">
                <label>Conflicts Detected:</label>
                <span class="conflict-count">{{ conflictsDetected }}</span>
              </div>
            </div>
          </div>

          <div class="monitoring-actions">
            <button class="action-btn start-btn"
                    *ngIf="!conflictMonitoringActive"
                    (click)="startConflictMonitoring()"
                    matTooltip="Start automated conflict detection">
              <i class="fas fa-play"></i>
              Start Monitoring
            </button>

            <button class="action-btn stop-btn"
                    *ngIf="conflictMonitoringActive"
                    (click)="stopConflictMonitoring()"
                    matTooltip="Stop automated conflict detection">
              <i class="fas fa-stop"></i>
              Stop Monitoring
            </button>

            <button class="action-btn scan-btn"
                    (click)="runManualConflictScan()"
                    matTooltip="Run immediate conflict scan">
              <i class="fas fa-search"></i>
              Scan Now
            </button>

            <button class="action-btn refresh-btn"
                    (click)="loadConflictMonitoringStatus()"
                    matTooltip="Refresh monitoring status">
              <i class="fas fa-sync-alt"></i>
              Refresh Status
            </button>

            <button class="action-btn clear-btn"
                    (click)="clearOldNotificationsAndScan()"
                    matTooltip="Clear old notifications and run fresh detailed scan">
              <i class="fas fa-broom"></i>
              Fresh Scan
            </button>

            <button class="action-btn test-btn"
                    (click)="createSampleDetailedNotification()"
                    matTooltip="Create sample detailed conflict notification for testing">
              <i class="fas fa-flask"></i>
              Test Sample
            </button>

            <button class="action-btn sync-btn"
                    (click)="forceRefreshNotifications()"
                    matTooltip="Force sync notifications with backend">
              <i class="fas fa-sync"></i>
              Force Sync
            </button>
          </div>
        </div>
      </section>

      <!-- Quick Actions Grid -->
      <section class="actions-section">
        <div class="section-header">
          <h2>Quick Actions</h2>
          <p>Manage your resources with these powerful tools</p>
        </div>
        
        <div class="actions-grid">
          <div class="action-card" 
               *ngFor="let card of dashboardCards; trackBy: trackByFn" 
                    [style.background]="card.gradient"
               (click)="navigateToCard(card.route)"
               [@slideInUp]="card">
            
            <div class="card-header">
              <div class="card-icon">{{ card.icon }}</div>
              <h3>{{ card.title }}</h3>
            </div>
            
            <div class="card-content">
              <p>{{ card.description }}</p>
            </div>
            
            <div class="card-footer">
              <button class="card-action-btn">
                {{ card.buttonText }}
                <i class="fas fa-arrow-right"></i>
              </button>
            </div>
            
            <div class="card-hover-effect"></div>
          </div>
        </div>
      </section>

      <!-- Recent Activity & Quick Overview -->
      <section class="overview-section">
        <div class="overview-grid">
          
          <!-- Recent Activity -->
          <div class="overview-card recent-activity">
            <div class="card-header">
              <h3>Recent Activity</h3>
              <button class="view-all-btn" (click)="viewAllActivity()">View All</button>
            </div>
            <div class="activity-list">
              <div class="activity-item" *ngFor="let activity of recentActivities" [@fadeInLeft]="activity">
                <div class="activity-icon" [ngClass]="activity.type">
                  <i [class]="activity.icon"></i>
                </div>
                <div class="activity-content">
                  <h4>{{activity.title}}</h4>
                  <p>{{activity.description}}</p>
                  <small>{{activity.timestamp}}</small>
                </div>
              </div>
            </div>
          </div>
          
          <!-- System Status -->
          <div class="overview-card system-status">
            <div class="card-header">
              <h3>System Status</h3>
              <div class="status-indicator" [ngClass]="systemStatus.overall">
                {{systemStatus.overall}}
              </div>
            </div>
            <div class="status-list">
              <div class="status-item" *ngFor="let status of systemStatus.services">
                <div class="status-label">{{status.name}}</div>
                <div class="status-value" [ngClass]="status.status">
                  <i class="fas" [class.fa-check-circle]="status.status === 'healthy'" 
                                [class.fa-exclamation-circle]="status.status === 'warning'"
                                [class.fa-times-circle]="status.status === 'error'"></i>
                  {{status.status}}
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
 
    </div>
  </main>

  <!-- Overlay for mobile -->
  <div class="sidebar-overlay" 
       *ngIf="sidebarOpen && isMobile" 
       (click)="toggleSidebar()"></div>
</div>

</body>
</html>